<h1>Search Last.fm</h1>

<%= form_with url: lastfm_search_path, method: :get, local: true do |f| %>
  <div>
    <%= f.label :q, 'Search for a song or artist' %>
    <%= f.text_field :q, value: @query, placeholder: 'song or artist name', size: 40 %>
    <%= f.submit 'Search', class: 'btn' %>
  </div>
<% end %>

<% if @tracks.present? %>
  <h2>Results for "<%= h(@query) %>"</h2>
  <ul class="search-results">
    <% @tracks.each do |t| %>
      <li style="display:flex; gap:12px; margin-bottom:12px; align-items:center;">
        <% if t[:image] %>
          <img src="<%= t[:image] %>" alt="<%= t[:album] %>" width="64" height="64" />
        <% end %>
        <div style="flex:1">
          <div><strong><%= t[:name] %></strong></div>
          <div><em><%= t[:artists] %></em> â€” <%= t[:album] %></div>
        </div>
        <div style="display:flex; flex-direction:column; gap:6px;">
          <%= link_to 'Review', new_review_path(track_id: t[:id], track_name: t[:name], artists: t[:artists], album_title: t[:album]), class: 'btn' %>
          <% if t[:external_url] %>
            <%= link_to 'Open in Last.fm', t[:external_url], target: '_blank', rel: 'noopener', class: 'btn btn-secondary' %>
          <% end %>
        </div>
      </li>
    <% end %>
  </ul>
<% elsif @query.present? %>
  <p>No results found for "<%= h(@query) %>".</p>
<% end %>

